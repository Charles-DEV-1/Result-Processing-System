{% extends "base.html" %}

{% block content %}
<div class="page">
  <div class="container">

    <!-- PAGE TITLE -->
    <div class="header">
      <h1>Admin Dashboard</h1>
      <p>All Student Results Overview</p>
    </div>

    <!-- FILTER FORM -->
    <div class="filter-form">
  <form method="GET">
    <h3>Filter Results</h3>

    <div class="filter-grid">
      <div>
        <label>Level</label>
        <select name="level">
          <option value="">All Levels</option>
          <option value="100" {% if selected_level == '100' %}selected{% endif %}>100</option>
          <option value="200" {% if selected_level == '200' %}selected{% endif %}>200</option>
          <option value="300" {% if selected_level == '300' %}selected{% endif %}>300</option>
          <option value="400" {% if selected_level == '400' %}selected{% endif %}>400</option>
        </select>
      </div>

      <div>
        <label>Department</label>
        <select name="department">
          <option value="">All Departments</option>
          {% for dept in departments %}
          <option value="{{ dept }}"
    {% if request.args.get('department') == dept %}selected{% endif %}>
    {{ dept }}
</option>

          {% endfor %}
        </select>
      </div>

      <div>
        <label>Semester</label>
        <select name="semester">
          <option value="">All Semesters</option>
          <option value="First" {% if selected_semester == 'First' %}selected{% endif %}>First</option>
          <option value="Second" {% if selected_semester == 'second' %}selected{% endif %}>Second</option>
        </select>
      </div>
    </div>

    <div class="filter-actions">
      <button type="submit" class="btn btn-primary">Apply Filters</button>

      <a
        href="{{ url_for('export_excel') }}?level={{ request.args.get('level','') }}&department={{ request.args.get('department','') }}&semester={{ request.args.get('semester','') }}"
        class="btn btn-success"
      >
        Export to Excel
      </a>
    </div>
  </form>
</div>

    <!-- RESULTS TABLE -->
    <div class="table-responsive">
      <table class="table-wrapper">

        <thead>
          <tr>
            <th>Matric No</th>
            <th>Student Name</th>

            {% set all_courses = [] %}
            {% for s in students %}
              {% for c in s.courses.keys() %}
                {% if c not in all_courses %}
                  {% set _ = all_courses.append(c) %}
                {% endif %}
              {% endfor %}
            {% endfor %}

            {% for course in all_courses %}
              <th>{{ course }}</th>
            {% endfor %}

            <th>GPA</th>
          </tr>
        </thead>

        <tbody>
          {% for s in students %}
          <tr>
            <td data-label="Matric No">{{ s.student.matric_number }}</td>
            <td data-label="Student Name">{{ s.student.full_name }}</td>

            {% for course in all_courses %}
              <td data-label="{{ course }}">{{ s.courses.get(course, "-") }}</td>
            {% endfor %}

            <td data-label="GPA"><strong>{{ s.gpa }}</strong></td>
          </tr>
          {% endfor %}
        </tbody>

      </table>
    </div>

    <!-- EMPTY STATE -->
    {% if not students %}
    <p style="text-align:center; padding:40px; color:#999;">
      No results found. Try adjusting the filters.
    </p>
    {% endif %}

  </div>
</div>
{% endblock %}



